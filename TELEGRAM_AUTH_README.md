# üîê –°–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Telegram

–≠—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ –ø–æ–∑–≤–æ–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º –≤—Ö–æ–¥–∏—Ç—å –Ω–∞ —Å–∞–π—Ç —á–µ—Ä–µ–∑ Telegram, –¥–∞–∂–µ –µ—Å–ª–∏ –æ–Ω–∏ –∑–∞—Ö–æ–¥—è—Ç –Ω–µ —á–µ—Ä–µ–∑ Telegram WebApp, –∞ —á–µ—Ä–µ–∑ –æ–±—ã—á–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä.

## üöÄ –ö–∞–∫ —ç—Ç–æ —Ä–∞–±–æ—Ç–∞–µ—Ç

1. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ö–æ–¥–∏—Ç –Ω–∞ —Å–∞–π—Ç** —á–µ—Ä–µ–∑ –æ–±—ã—á–Ω—ã–π –±—Ä–∞—É–∑–µ—Ä
2. **–°–∏—Å—Ç–µ–º–∞ –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç**, —á—Ç–æ –Ω–µ—Ç –¥–∞–Ω–Ω—ã—Ö Telegram WebApp
3. **–ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è —Ñ–æ—Ä–º–∞** –¥–ª—è –≤–≤–æ–¥–∞ Telegram username
4. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç** —Å–≤–æ–π @username
5. **–°–∏—Å—Ç–µ–º–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç**, —á—Ç–æ —Ç–∞–∫–æ–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —Å—É—â–µ—Å—Ç–≤—É–µ—Ç –≤ –±–æ—Ç–µ
6. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∏–¥–µ—Ç –≤ –±–æ—Ç** –∏ –Ω–∞–∂–∏–º–∞–µ—Ç "üîê –ö–æ–¥ –¥–ª—è —Å–∞–π—Ç–∞"
7. **–ë–æ—Ç –≥–µ–Ω–µ—Ä–∏—Ä—É–µ—Ç** 6-–∑–Ω–∞—á–Ω—ã–π –∫–æ–¥ –∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—é
8. **–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –≤–≤–æ–¥–∏—Ç –∫–æ–¥** –Ω–∞ —Å–∞–π—Ç–µ
9. **–°–∏—Å—Ç–µ–º–∞ –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä—É–µ—Ç –∫–æ–¥** –∏ –∞–≤—Ç–æ—Ä–∏–∑—É–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

## üìã –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞

### 1. –í—ã–ø–æ–ª–Ω–∏—Ç–µ –º–∏–≥—Ä–∞—Ü–∏—é –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–û—Ç–∫—Ä–æ–π—Ç–µ Supabase SQL Editor –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–∫—Ä–∏–ø—Ç –∏–∑ —Ñ–∞–π–ª–∞ `database/migration.sql`:

```sql
-- –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –∏ –≤—ã–ø–æ–ª–Ω–∏—Ç–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ migration.sql
```

### 2. –û–±–Ω–æ–≤–∏—Ç–µ –±–æ—Ç–∞

–ö–æ–¥ –±–æ—Ç–∞ —É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω –∏ –≤–∫–ª—é—á–∞–µ—Ç:
- –ù–æ–≤—ã–µ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –∫–æ–º–∞–Ω–¥ `/webauth` –∏ –∫–Ω–æ–ø–∫–∏ "üîê –ö–æ–¥ –¥–ª—è —Å–∞–π—Ç–∞"
- –§—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∫–æ–¥–æ–≤
- –û–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é –≥–ª–∞–≤–Ω—É—é –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–æ–π –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–æ–¥–∞

### 3. –û–±–Ω–æ–≤–∏—Ç–µ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ

–í–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —É–∂–µ –æ–±–Ω–æ–≤–ª–µ–Ω–æ –∏ –≤–∫–ª—é—á–∞–µ—Ç:
- –ö–æ–º–ø–æ–Ω–µ–Ω—Ç `TelegramAuth` –¥–ª—è —Ñ–æ—Ä–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- API —Ñ—É–Ω–∫—Ü–∏–∏ –¥–ª—è –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏ –∫–æ–¥–æ–≤
- –û–±–Ω–æ–≤–ª–µ–Ω–Ω—É—é –ª–æ–≥–∏–∫—É –≤ `App.tsx` –¥–ª—è –ø–æ–∫–∞–∑–∞ —Ñ–æ—Ä–º—ã –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏

## üéØ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### –î–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π

1. –û—Ç–∫—Ä–æ–π—Ç–µ —Å–∞–π—Ç –≤ –±—Ä–∞—É–∑–µ—Ä–µ
2. –ï—Å–ª–∏ –≤—ã –Ω–µ –∑–∞—Ö–æ–¥–∏–ª–∏ —á–µ—Ä–µ–∑ Telegram, –ø–æ—è–≤–∏—Ç—Å—è —Ñ–æ—Ä–º–∞ –≤—Ö–æ–¥–∞
3. –í–≤–µ–¥–∏—Ç–µ —Å–≤–æ–π Telegram username (—Å @ –∏–ª–∏ –±–µ–∑)
4. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ –±–æ—Ç @tontraderbot
5. –ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É "üîê –ö–æ–¥ –¥–ª—è —Å–∞–π—Ç–∞"
6. –°–∫–æ–ø–∏—Ä—É–π—Ç–µ –ø–æ–ª—É—á–µ–Ω–Ω—ã–π –∫–æ–¥
7. –í–≤–µ–¥–∏—Ç–µ –∫–æ–¥ –Ω–∞ —Å–∞–π—Ç–µ
8. –ì–æ—Ç–æ–≤–æ! –í—ã –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω—ã

### –î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫–æ–≤

#### –ö–æ–º–ø–æ–Ω–µ–Ω—Ç TelegramAuth

```tsx
import TelegramAuth from './components/TelegramAuth';

<TelegramAuth 
  onAuthSuccess={(user) => {
    // –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å —É—Å–ø–µ—à–Ω–æ –∞–≤—Ç–æ—Ä–∏–∑–æ–≤–∞–Ω
    setUser(user);
  }}
  onClose={() => {
    // –ó–∞–∫—Ä—ã—Ç—å —Ñ–æ—Ä–º—É –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
    setShowAuth(false);
  }}
/>
```

#### API —Ñ—É–Ω–∫—Ü–∏–∏

```typescript
import { verifyTelegramCode, checkUserExists } from './api/verify-telegram';

// –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
const exists = await checkUserExists('@username');

// –í–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥
const result = await verifyTelegramCode('@username', '123456');
if (result.success) {
  console.log('–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:', result.user);
}
```

## üîß –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

### –í—Ä–µ–º—è –∂–∏–∑–Ω–∏ –∫–æ–¥–∞

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫–æ–¥ –¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª–µ–Ω **10 –º–∏–Ω—É—Ç**. –ò–∑–º–µ–Ω–∏—Ç—å –º–æ–∂–Ω–æ –≤ —Ñ—É–Ω–∫—Ü–∏–∏ `generate_verification_code`:

```sql
expires_at TIMESTAMP WITH TIME ZONE DEFAULT (NOW() + INTERVAL '10 minutes')
```

### –î–ª–∏–Ω–∞ –∫–æ–¥–∞

–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∫–æ–¥ **6 —Ü–∏—Ñ—Ä**. –ò–∑–º–µ–Ω–∏—Ç—å –º–æ–∂–Ω–æ –≤ —Ñ—É–Ω–∫—Ü–∏–∏:

```sql
v_code := LPAD(FLOOR(RANDOM() * 1000000)::TEXT, 6, '0');
```

### –ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞

–°–∏—Å—Ç–µ–º–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —É–¥–∞–ª—è–µ—Ç:
- –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–Ω—ã–µ –∫–æ–¥—ã
- –ò—Å—Ç–µ–∫—à–∏–µ –∫–æ–¥—ã

–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –º–æ–∂–Ω–æ –Ω–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫—É—é –æ—á–∏—Å—Ç–∫—É —á–µ—Ä–µ–∑ `schedule_cleanup_verification_codes()`.

## üõ°Ô∏è –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

### –ó–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫

1. **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ –∂–∏–∑–Ω–∏** - –∫–æ–¥—ã –∏—Å—Ç–µ–∫–∞—é—Ç —á–µ—Ä–µ–∑ 10 –º–∏–Ω—É—Ç
2. **–û–¥–Ω–æ—Ä–∞–∑–æ–≤–æ–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ** - –∫–æ–¥ –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ
3. **–ü—Ä–∏–≤—è–∑–∫–∞ –∫ username** - –∫–æ–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç —Ç–æ–ª—å–∫–æ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
4. **–ê–≤—Ç–æ–æ—á–∏—Å—Ç–∫–∞** - —Å—Ç–∞—Ä—ã–µ –∫–æ–¥—ã —É–¥–∞–ª—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

### –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

1. **–ù–µ –ª–æ–≥–∏—Ä—É–π—Ç–µ –∫–æ–¥—ã** –≤ production
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ HTTPS** –¥–ª—è –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
3. **–û–≥—Ä–∞–Ω–∏—á—å—Ç–µ —á–∞—Å—Ç–æ—Ç—É –∑–∞–ø—Ä–æ—Å–æ–≤** –∫–æ–¥–æ–≤ (rate limiting)
4. **–ú–æ–Ω–∏—Ç–æ—Ä—å—Ç–µ –ø–æ–¥–æ–∑—Ä–∏—Ç–µ–ª—å–Ω—É—é –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å**

## üêõ –û—Ç–ª–∞–¥–∫–∞

### –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–æ–≤ –≤ –±–∞–∑–µ –¥–∞–Ω–Ω—ã—Ö

```sql
SELECT * FROM verification_codes 
WHERE telegram_username = '@username' 
ORDER BY created_at DESC;
```

### –û—á–∏—Å—Ç–∫–∞ —Ç–µ—Å—Ç–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö

```sql
DELETE FROM verification_codes 
WHERE telegram_username = '@test_user';
```

### –õ–æ–≥–∏ –±–æ—Ç–∞

–ë–æ—Ç –ª–æ–≥–∏—Ä—É–µ—Ç –≤—Å–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ —Å –∫–æ–¥–∞–º–∏:
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—é –∫–æ–¥–æ–≤
- –ü–æ–ø—ã—Ç–∫–∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –û—à–∏–±–∫–∏

## üì± –ö–æ–º–∞–Ω–¥—ã –±–æ—Ç–∞

- `/webauth` - –ü–æ–ª—É—á–∏—Ç—å –∫–æ–¥ –¥–ª—è –≤—Ö–æ–¥–∞ –Ω–∞ —Å–∞–π—Ç
- –ö–Ω–æ–ø–∫–∞ "üîê –ö–æ–¥ –¥–ª—è —Å–∞–π—Ç–∞" –≤ –≥–ª–∞–≤–Ω–æ–º –º–µ–Ω—é

## üîÑ –û–±–Ω–æ–≤–ª–µ–Ω–∏—è

### –í–µ—Ä—Å–∏—è 1.0
- –ë–∞–∑–æ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
- –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –∫–æ–¥–æ–≤
- –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º

### –ü–ª–∞–Ω–∏—Ä—É–µ–º—ã–µ —É–ª—É—á—à–µ–Ω–∏—è
- Rate limiting –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫–æ–¥–æ–≤
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –æ –≤—Ö–æ–¥–∞—Ö —Å –Ω–æ–≤—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤
- –î–≤—É—Ö—Ñ–∞–∫—Ç–æ—Ä–Ω–∞—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è
- –°–µ—Å—Å–∏–∏ –∏ refresh —Ç–æ–∫–µ–Ω—ã

## üÜò –ü–æ–¥–¥–µ—Ä–∂–∫–∞

–ü—Ä–∏ –≤–æ–∑–Ω–∏–∫–Ω–æ–≤–µ–Ω–∏–∏ –ø—Ä–æ–±–ª–µ–º:

1. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–∏ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
2. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ –±–æ—Ç–µ
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—Ä–∞–≤–∏–ª—å–Ω–æ—Å—Ç—å username (—Å @ –∏–ª–∏ –±–µ–∑)
4. –£–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –∫–æ–¥ –Ω–µ –∏—Å—Ç–µ–∫ (10 –º–∏–Ω—É—Ç)
5. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ –±–æ—Ç–∞ –∏ –≤–µ–±-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

---

**–°–∏—Å—Ç–µ–º–∞ –≥–æ—Ç–æ–≤–∞ –∫ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é!** üéâ