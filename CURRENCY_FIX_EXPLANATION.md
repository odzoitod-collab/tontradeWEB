# Исправление системы валют - Реальные рубли

## Проблема была:
- Баланс показывался в рублях (100,000₽)
- Но при вводе ставки система думала, что вы вводите доллары
- Поэтому нельзя было поставить 50,000₽ при балансе 100,000₽

## Что исправлено:

### 1. **Правильная конвертация баланса**
```javascript
// Баланс в БД хранится в USD, конвертируем для отображения
const rawBalance = user?.balance || 0; // USD из БД
const currentBalance = convertFromUSD(rawBalance, userCurrency); // Конвертируем в рубли
```

### 2. **Правильная проверка ставки**
```javascript
// Конвертируем ставку пользователя в USD для сравнения с балансом в БД
const dealAmountUSD = convertToUSD(deal.amount, userCurrency);
if (user.balance >= dealAmountUSD) { // Сравниваем USD с USD
  // Создаем сделку
}
```

### 3. **Правильный расчет PnL**
```javascript
// PnL рассчитывается в валюте пользователя
const rawPnl = pnlRatio * deal.leverage * deal.amount; // В рублях
// Но для сохранения в БД конвертируем в USD
const netProfitUSD = convertToUSD(netProfit, userCurrency);
```

## Примеры работы:

### Пример 1: Баланс 100,000₽
- **Отображается**: 100,000₽
- **Можно поставить**: до 100,000₽
- **Ставка 50,000₽**: ✅ Работает!

### Пример 2: Ставка 50,000₽, рост +2%, плечо x10
- **Прибыль**: 50,000₽ × 2% × 10 = **+10,000₽**
- **Итого**: 50,000₽ + 10,000₽ = **60,000₽**

### Пример 3: Демо режим
- **RUB**: 1,000,000₽ (≈ $10,000)
- **KZT**: 4,500,000₸ (≈ $10,000)
- **UZS**: 123,500,000 сум (≈ $10,000)

## Техническая схема:

```
Пользователь видит: 100,000₽
         ↓
БД хранит: $1,000 (100,000₽ ÷ 100 = $1,000)
         ↓
Ставка: 50,000₽ → конвертируем в $500
         ↓
Проверка: $1,000 >= $500 ✅
         ↓
PnL: +10,000₽ → конвертируем в +$100 для БД
         ↓
Новый баланс в БД: $1,100
         ↓
Показываем пользователю: 110,000₽
```

## Что изменилось в коде:

1. **App.tsx**: Конвертация баланса при передаче в компоненты
2. **handleCreateDeal**: Конвертация суммы ставки для проверки баланса
3. **Game Loop**: Конвертация PnL для сохранения в БД
4. **handleWithdraw**: Конвертация суммы вывода
5. **Demo Mode**: Правильные начальные балансы в валютах

Теперь система работает корректно - вы вводите реальные рубли и можете ставить любую сумму в пределах вашего баланса!