# Система торговли с кредитным плечом

## Как работает новая система:

### 1. Движение цены
- При открытии сделки монета изменяется на **1-3%** в течение времени сделки
- Направление движения зависит от настройки "удачи" пользователя:
  - `win` - цена идет в пользу пользователя
  - `lose` - цена идет против пользователя  
  - `default` - случайное направление (50/50)

### 2. Расчет прибыли/убытка

#### Пример 1: Без кредитного плеча (x1)
- Ставка: $100
- Рост монеты: +2%
- Прибыль: $100 × 2% = **$2**

#### Пример 2: С кредитным плечом x20
- Ставка: $100  
- Рост монеты: +2%
- Прибыль: $100 × 2% × 20 = **$40**

#### Пример 3: Убыток с плечом x20
- Ставка: $100
- Падение монеты: -2%
- Убыток: $100 × 2% × 20 = **-$40**
- Остается: $100 - $40 = **$60**

### 3. Настройки по умолчанию
- Время сделки: **30 секунд**
- Кредитное плечо: **x10**
- Изменение цены: **1-3%**

### 4. Как это работает в коде:

```javascript
// Расчет изменения цены (1-3%)
const minChange = 0.01; // 1%
const maxChange = 0.03; // 3%
const targetChangePercent = minChange + (maxChange - minChange) * randomFactor;

// Расчет PnL с учетом плеча
const pnlRatio = (currentPrice - entryPrice) / entryPrice;
const rawPnl = pnlRatio * leverage * amount;
const payout = Math.max(0, amount + rawPnl);
```

### 5. Безопасность
- Максимальный убыток = размер ставки
- Минимальная выплата = $0 (не может быть отрицательной)
- Плечо ограничено до x20

Система теперь работает точно по вашим требованиям!